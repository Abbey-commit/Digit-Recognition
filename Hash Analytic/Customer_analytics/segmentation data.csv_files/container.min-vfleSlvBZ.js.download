define(["require","exports","tslib","prop-types","react","spectrum-sharing/utils/sharing_constants","modules/clean/auth/login_or_register/types","modules/clean/cloud_docs/types","modules/clean/react/file_viewer/file_viewer","modules/clean/react/file_viewer/sdk_file_viewer/async_file_viewer","modules/clean/react/file_viewer/sdk_file_viewer/utils","modules/clean/open_in_app/actions","modules/clean/sharing/async_share_modal_util","modules/clean/viewer","modules/clean/react/file_viewer/data/store","modules/clean/web_timing_logger","modules/clean/react/extensions/data/store","modules/clean/integrations/zoom_share_dialog/async_modal","modules/constants/file_viewer","file-viewer/public/support","modules/clean/previews/constants","modules/clean/previews/util","modules/core/browser","modules/clean/react/file_viewer/sdk_file_viewer/utils"],(function(e,i,t,r,n,o,s,a,l,d,u,p,c,_,h,f,m,w,g,v,S,y,I,b){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FileViewerContainer=void 0,r=t.__importDefault(r),n=t.__importDefault(n),I=t.__importStar(I);var E=(function(i){function E(e){var t=i.call(this,e)||this,r=_.Viewer.get_viewer(),n=e.userId?r.get_user_by_id(e.userId):r.work_user||r.personal_user;t.state={user:n,isCapture:!1},f.log_js_modules_application_code_start();var o=e.file,s=h.getStoreForFileViewer();return h.hydrateFileViewerNamespace(s,{file:o},n),n&&m.initializeStore(n,[o]),t}return t.__extends(E,i),E.prototype.componentDidMount=function(){var i,r=this,o=this.props,l=o.shareEmail,d=o.shareModalVariant,u=o.sharedLinkInfo,_=o.file;if(new URLSearchParams(I.get_uri()).get("capture")&&this.setState({isCapture:!0}),l||d&&d!==a.ShareModalVariant.closed&&this.state.user)new Promise((function(i,t){e(["modules/clean/react/browse/models"],i,t)})).then(t.__importStar).then((function(e){var i=e.File,t=l?l.split(","):[];c.asyncShowPrefilledShareModal({user:r.state.user,sharePrefillEmails:t,content:new i(r.props.file)})}));else if(this.props.authModalKind!==s.LoginOrRegisterKind.IMMEDIATE||this.state.user||this.state.isCapture)this.props.presentInZoom&&this.state.user&&w.asyncShowModal(this.state.user.id,_.file_id,"file-viewer-modal-overlay","desktop");else{i=this.props.encryptionOptions,t.__awaiter(r,void 0,void 0,(function(){var r,o,a;return t.__generator(this,(function(l){switch(l.label){case 0:return[4,Promise.all([new Promise((function(i,t){e(["modules/clean/react/modal"],i,t)})).then(t.__importStar),new Promise((function(i,t){e(["modules/clean/auth/login_or_register/modal"],i,t)})).then(t.__importStar)])];case 1:return r=l.sent(),o=r[0].Modal,a=r[1].LoginOrRegisterModal,o.showInstance(n.default.createElement(a,{downloadAction:null,id:"shared-link-immediate-signup-modal",initialMode:s.Mode.REGISTER,kind:s.LoginOrRegisterKind.IMMEDIATE,onCancel:function(){},signup_tag:"shmodel_modal_register",showGoogleRegistration:!0,googleRegisterProps:u?{signupContinuationUrl:u.url}:void 0,encryptionOptions:i})),[2]}}))}))}if(this.props.openImmediatelyInApp){var h=this.props.file;p.openImmediately(h.open_in_app_data)}},E.prototype.couldUseSDKToRender=function(e,i,t){if(!t||void 0===i||y.isCloudDocPreview(e)||this.isBrandingInfoDefined())return!1;var r=e.preview_type===S.PreviewType.Audio||e.preview_type===S.PreviewType.Video,n=e.preview_type===S.PreviewType.Archive,o=this.isFVSDKAudioVideoSupportEnabled()&&r,s=this.isFVSDKArchiveSupportEnabled()&&n,a=v.isPreviewTypeSupported(e.preview,u.INBAND_SUPPORTED_TYPES)&&!r&&!n||s||o;return Boolean(a)},E.prototype.isInbandExperimentEnabled=function(){return g.INBAND_FVSDK_LINKS},E.prototype.isFVSDKArchiveSupportEnabled=function(){return g.FVSDK_ARCHIVE_SUPPORT},E.prototype.isFVSDKAudioVideoSupportEnabled=function(){return g.FVSDK_AUDIO_VIDEO_SUPPORT},E.prototype.isBrandingInfoDefined=function(){var e=this.props.brandingInfo;return e&&Object.keys(e).some((function(i){return!!e[i]}))},E.prototype.render=function(){var e=this.props,i=e.file,r=e.fileViewerProps,s=e.onCloseUrl,a=e.isEmbedded,u=e.brandingInfo,p=e.encryptionOptions,c=e.openInHelloSign,_=e.openInHelloSignSrc,h=e.sharedLinkInfo,f=e.shareToken,m=e.sharePermission,w=e.LoggedOutUXGoogleVariant,g=e.authModalKind,v=e.expGrowthActSmbWorkflowsBaton,S=this.state.user,y=Boolean(h&&f&&!(null==h?void 0:h.hasPublicAudienceOrVisibility)&&(null==f?void 0:f.linkType)===o.SharedLinkType.Content),I=this.couldUseSDKToRender(i,S,y),E=I&&this.isInbandExperimentEnabled()?n.default.createElement(d.AsyncFileViewer,{file:i,sharedLinkInfo:h,sharePermission:m,shareToken:f,user:S,previewSurface:b.SDKPreviewSurface.INBAND_SHARE}):n.default.createElement(l.FileViewer,t.__assign({},r,{fileCount:1,fileIndex:0,titleBarCloseUrl:s,sharedLinkInfo:h,brandingInfo:u,openInHelloSign:c,openInHelloSignSrc:_,shareToken:f,sharePermission:m,user:S,transparentBackground:!1,LoggedOutUXGoogleVariant:w,encryptionOptions:p,authModalKind:g,isInbandExperiment:I,expGrowthActSmbWorkflowsBaton:v,isCapture:this.state.isCapture}));return a?n.default.createElement("div",{className:"embedded"},E):E},E.prototype.getChildContext=function(){return{authModalKind:this.props.authModalKind}},E.childContextTypes={authModalKind:r.default.oneOf(["download","immediate",null])},E})(n.default.Component);i.FileViewerContainer=E}));
//# sourceMappingURL=container.min.js-vflhx79qR.map