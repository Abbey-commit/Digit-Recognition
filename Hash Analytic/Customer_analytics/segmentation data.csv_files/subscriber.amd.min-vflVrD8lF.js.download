define(["require","exports","tslib","tslib","lodash","rondo/invariant/index","rondo/metadata/index","rondo/behavior/delayed_op"],(function(e,r,t,i,n,s,u,b){"use strict";var o;Object.defineProperty(r,"__esModule",{value:!0}),r.once=r.whenFieldChanged=r.whenFieldDefined=r.subscribeStateWhen=r.subscribeState=r.StateSubscriberInBehavior=r.STATE_SUBSCRIBER_FIELD_TYPE=void 0,n=t.__importStar(n),r.STATE_SUBSCRIBER_FIELD_TYPE="StateSubscriber";var a=(function(e){function t(t,i,u){var b=e.call(this,(function(){return b.subscribe()}),["_behavior","_store"],(function(){return!!b.behavior&&!!b.store}))||this;return b[o]=r.STATE_SUBSCRIBER_FIELD_TYPE,b.unsubscribe=function(){s.invariant(!!b._unsubscribe,"Cannot call unsubscribe before subscribing to the store"),b._unsubscribe()},b.subscribe=function(){s.invariant(!!b.behavior&&!!b.store,"Subscribe for state subscriber called before behavior and/or store are set");var e=b.store.getState(),r=b.behavior.pathState(e),t=b.store.subscribe((function(){var t=b.store.getState(),i=b.behavior.pathState(t);if(!n.isEqual(r,i)){var s=r;r=i,b.subscriberFns.forEach((function(r){return r({state:s,fullState:e},{state:i,fullState:t})}))}e=t}));b._unsubscribe=function(){var e=b.behavior.unsubscribers.indexOf(b.unsubscribe);e>-1&&b.behavior.unsubscribers.splice(e,1),t()}},b.listen=function(e,r){b.subscriberFns.push(r),e.addUnsubscribers((function(){var e=b.subscriberFns.indexOf(r);e>-1&&b.subscriberFns.splice(e,1)}))},b.behavior=i,b.store=u,b.subscriberFns=[t],b}return i.__extends(t,e),Object.defineProperty(t.prototype,"behavior",{get:function(){return this._behavior},set:function(e){e!==this._behavior&&this.reset(),this._behavior=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"store",{get:function(){return this._store},set:function(e){e!==this._store&&this.reset(),this._store=e},enumerable:!0,configurable:!0}),t})(b.DelayedOperation);r.StateSubscriberInBehavior=a,o=u.ENTRY_FIELD_TYPE,r.subscribeState=function(e){return new a(e)},r.subscribeStateWhen=function(e,t){return r.subscribeState((function(r,i){e(i.state,r.state)&&t(r,i)}))},r.whenFieldDefined=function(e,t){return r.subscribeStateWhen((function(r,t){var i=n.get(r,n.isString(e)?[e]:e),s=n.get(t,n.isString(e)?[e]:e);return!n.isEqual(i,s)&&void 0!==i}),t)},r.whenFieldChanged=function(e,t){return r.subscribeStateWhen((function(r,t){var i=n.get(t,n.isString(e)?[e]:e),s=n.get(r,n.isString(e)?[e]:e);return!n.isEqual(i,s)}),t)},r.once=function(e){var r=e.subscriberFns[0];return e.subscriberFns[0]=function(t,i){r(t,i),e.unsubscribe()},e}}));
//# sourceMappingURL=subscriber.amd.min.js-vfl3uAQuf.map