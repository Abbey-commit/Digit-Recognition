define(["require","exports","tslib","tslib","redux-actions","lodash","redux-saga","rondo/behavior/types","rondo/behavior/internal_actions","rondo/action_listener_middleware/index","rondo/slice_selectors/index","rondo/behavior/compose/path","rondo/performance/mark","rondo/metadata/index","rondo/invariant/index","rondo/selectors/selector","rondo/behavior/compose/compose_behavior","rondo/actions/types","rondo/behavior/handle","rondo/behavior/initial_state","rondo/behavior/subscribers/index","rondo/behavior/utils","rondo/saga/saga_creator"],(function(e,t,i,r,o,s,n,a,c,h,d,p,l,u,f,v,_,g,y,E,m,b,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extendBehavior=t.createBehavior=t.behavior=void 0,s=i.__importStar(s),n=i.__importDefault(n);function O(e,i,o){var s,n=b.isBehaviorClass(e)?e:t.behavior(e),a=i||{slicePath:void 0,context:void 0},c=a.slicePath,h=a.context,d=r.__rest(a,["slicePath","context"]);return c||h?(f.invariant(0===Object.keys(d).length,"createBehavior options cannot include fields other than slicePath and context"),s=new n({slicePath:c,context:h})):s=Object.keys(d).length>0?new n(o,d):new n(void 0),s}t.behavior=function(e){return(function(t){function i(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o=t.call(this,e.length>1?e[1]:void 0)||this;o.__type__=a.BEHAVIOR_FIELD_TYPE,o.sagas=[],o._path=[],o._registerCount=0,o.getState=function(){return f.invariant(!!o._getState,"Trying to access "+o.id+" state before store is set"),o.path.length>0?s.get(o._getState(),o.path):o._getState()},o.getFullState=function(){return f.invariant(!!o._getState,"Trying to access "+o.id+" state before store is set"),o._getState()},o.collectReducers=function(e){var t;if(e!==o){if(e.isRegistered)return;(t=o.actionHandlers).push.apply(t,r.__spread(e.actionHandlers||[]))}e.composedBehaviors&&e.composedBehaviors.forEach(o.collectReducers)},o.collectInitialStates=function(e){var t;if(e!==o){if(e.isRegistered)return;(t=o.initialStates).push.apply(t,r.__spread(e.initialStates||[]))}e.composedBehaviors&&e.composedBehaviors.forEach(o.collectInitialStates)},o.collectAction=function(e,t){return void 0===t&&(t={}),u.entriesOfTypeField(o,g.ACTION_FIELD_TYPE).forEach((function(e){var i=e.key,r=e.field;return s.set(t,o.path.concat(i),r)})),e.composedBehaviors&&e.composedBehaviors.forEach((function(e){return e.collectAction(e,t)})),t},o.collectActionWatcher=function(e){var t;if(e!==o){if(e.isRegistered)return;(t=o.actionWatchers).push.apply(t,r.__spread(e.actionWatchers||[]))}e.composedBehaviors&&e.composedBehaviors.forEach(o.collectActionWatcher)},o.collectSaga=function(e){var t,i;if(e!==o){if(e.isRegistered)return;(t=o.sagas).push.apply(t,r.__spread(e.sagas||[]))}(i=o.sagas).push.apply(i,r.__spread((e.sagaHandlers||[]).map((function(e){return e.create()})))),e.composedBehaviors&&e.composedBehaviors.forEach(o.collectSaga)};var n=e.length>=1&&a.isBehaviorOptions(e[0])?e[0]:void 0;return n&&(n.context&&(o.context=n.context),"string"==typeof n.slicePath&&(o.slice=n.slicePath)),o.bindMethodsToObject(),o.id=o._generateUniqueId(),o.sagaTasks=[],o.init(),n&&Array.isArray(n.slicePath)&&(o.path=n.slicePath),o}return r.__extends(i,t),i.prototype.ctrKeys=function(){return Object.keys(e.prototype).concat(Object.keys(this))},i.prototype.extendBehavior=function(e){var t=this;e.slice||(u.entriesOfTypeField(e,g.ACTION_FIELD_TYPE).forEach((function(i){var r=i.key;i.field;t.hasOwnProperty(r)||Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))})),u.entriesOfTypeField(e,v.SELECTOR_FIELD_TYPE).forEach((function(i){var r=i.key;i.field;t.hasOwnProperty(r)||Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))})),u.entriesOfTypeField(e,a.BEHAVIOR_FIELD_TYPE).forEach((function(i){var r=i.key;Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r)),t._ignoreCompose=(t._ignoreCompose||[]).concat(r)})))},i.prototype.init=function(){var e=this;u.entriesOfTypeField(this,a.BEHAVIOR_FIELD_TYPE,this.ctrKeys()).forEach((function(t){var i=t.key,r=t.field;(!e._ignoreCompose||e._ignoreCompose.indexOf(i)<0)&&_.composeBehavior(e,r,r.slice||i)})),this.actionWatchers=this.actionWatchers||[],this.actionHandlers=this.actionHandlers||[],this.initialStates=this.initialStates||[],this.initialState&&this.initialStates.push(new E.InitialState(this.initialState,this)),this.sagas=[],u.entriesOfTypeField(this,g.ACTION_FIELD_TYPE).forEach((function(t){var i=t.key;return t.field.init(e,u.camelCaseToUnderscorePattern(i))})),this.selectors=this.selectors||{},u.entriesOfTypeField(this,v.SELECTOR_FIELD_TYPE).forEach((function(t){var i=t.key,r=t.field;r.init(e),e.selectors[i]=r})),u.entriesOfTypeField(this,S.SAGA_FIELD_TYPE).forEach((function(t){var i=t.key,r=t.field.bind(e);e[i]=r,e.sagas.push(r)})),this.pendingComposedBehaviors&&this.pendingComposedBehaviors.length>0&&_.composeBehaviors(this.pendingComposedBehaviors.splice(0))(this),this._initBehaviorReducer()},i.prototype.bindMethodsToObject=function(){var t,i;try{for(var o=r.__values(Object.getOwnPropertyNames(e.prototype)),n=o.next();!n.done;n=o.next()){var a=n.value,c=this[a];s.isFunction(c)&&"constructor"!==a&&(this[a]=c.bind(this))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}},i.prototype.addBehavior=function(e){(this.pendingComposedBehaviors=this.pendingComposedBehaviors||[]).push(e),this.extendBehavior(e)},i.prototype.addUnsubscribers=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];(e=this.unsubscribers=this.unsubscribers||[]).push.apply(e,r.__spread(t))},Object.defineProperty(i.prototype,"_displayName",{get:function(){return this.constructor.displayName},enumerable:!0,configurable:!0}),i.prototype._generateUniqueId=function(){return"BEHAVIOR-"+(this._displayName?this._displayName+"-":"")+(this.slice?this.slice+"-":"")+Math.random().toString(36).substr(2,9)},i.prototype._initBehaviorReducer=function(){var e=this;this._attachReducer(c.actionInitBehavior(this.id),(function(t,i){var r=E.mergeInitialState(e.initialStates,e.path);return r?s.assignIn({},r,t):t}))},i.prototype._attachReducer=function(e,t){this.actionHandlers=this.actionHandlers||[],this.actionHandlers.push(new y.HandleAction(t,e,!1,!1,this,this))},Object.defineProperty(i.prototype,"path",{get:function(){return this._path?this._path.concat(this.slice||[]):[]},set:function(e){this._path=e,this.composedBehaviors&&p.setComposePath(this.composedBehaviors,this.path)},enumerable:!0,configurable:!0}),i.prototype.pathState=function(e){return this.path.length>0?s.get(e,this.path):e},Object.defineProperty(i.prototype,"context",{get:function(){return this._context},set:function(e){this._context=e,this.composedBehaviors&&this.composedBehaviors.forEach((function(t){return t.context=e}))},enumerable:!0,configurable:!0}),i.prototype.createWatchers=function(e){var t=e.get(a.ACTION_LISTENERS_MIDDLEWARE);t||(t=h.ActionListenerMiddleware(),e.register({name:a.ACTION_LISTENERS_MIDDLEWARE,middleware:t,order:0})),this.collectActionWatcher(this),this.addUnsubscribers.apply(this,r.__spread(this.actionWatchers.map((function(e){return e.create(t)}))))},i.prototype.middlewares=function(e){this.isRegistered||(this.createWatchers(e),this.createSagaMiddleware(e))},i.prototype.createSagaMiddleware=function(e){var t=e.get(a.SAGA_MIDDLEWARE);t||(t=n.default(),e.register({name:a.SAGA_MIDDLEWARE,middleware:t,order:0}))},i.prototype.postStoreCreation=function(t,i){var r=this;if(this.store=t,this.dispatch=t.dispatch,this._getState=t.getState,u.entriesOfTypeField(this,m.STATE_SUBSCRIBER_FIELD_TYPE).forEach((function(e){e.key;var i=e.field;i.behavior=r,i.store=t})),this.composedBehaviors&&this.composedBehaviors.forEach((function(e){e.postStoreCreation(t)})),i){var o=i.get(a.SAGA_MIDDLEWARE);o&&!this.isRegistered&&(this.collectSaga(this),this.sagas.forEach((function(e){return r.sagaTasks.push(o.run(e))})))}if(e.prototype.hasOwnProperty("ready")){var s=t.getState();this.ready(this.pathState(s),s)}},i.prototype.createReducer=function(){this.collectInitialStates(this),this.collectReducers(this);var e=E.mergeInitialState(this.initialStates,this.path);if(0===this.actionHandlers.length)return function(t){return void 0===t&&(t=e),t};var t=y.mergeHandles(this.actionHandlers);return o.handleActions(t,e)},i.prototype.createSelectors=function(){var e=this;return d.select(this.selectors,(function(t){return e.slice?t[e.slice]:t}))},Object.defineProperty(i.prototype,"isRegistered",{get:function(){return this._registerCount>0},enumerable:!0,configurable:!0}),i.prototype.register=function(){return this._registerCount++,(this.composedBehaviors||[]).forEach((function(e){return e.register()})),this._registerCount},i.prototype.unregister=function(e){return void 0===e&&(e=!1),this._registerCount--,(this.composedBehaviors||[]).forEach((function(e){return e.unregister(!0)})),this.isRegistered||(this.unsubscribers&&this.unsubscribers.length>0&&this.unsubscribers.splice(0).forEach((function(e){return e()})),e&&(this.actionWatchers=[],this.sagaHandlers=[],this.sagas=[]),this.sagaTasks.forEach((function(e){return e.cancel()})),this.sagaTasks=[],this.dispatch=void 0,this.store=void 0,this._getState=void 0),this._registerCount},i.__type__=a.BEHAVIOR_CLASS_FIELD_TYPE,i.displayName=(function(e){return e.hasOwnProperty("displayName")})(e)?e.displayName:(function(e){return e.hasOwnProperty("name")})(e)?e.name:"Behavior-"+Math.random().toString(36).substr(2,9),r.__decorate([l.markAroundDecorator("init")],i.prototype,"init",null),i})(e)},t.createBehavior=O,t.extendBehavior=function(e,t){b.isBehavior(t)||(t=O(t)),e.addBehavior(t)}}));
//# sourceMappingURL=behavior.amd.min.js-vflyPcR6p.map